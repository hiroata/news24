(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(1974)}])},4933:function(e,t,n){"use strict";n.d(t,{z:function(){return AudioPlayer}});var s=n(5893);n(7294);let AudioPlayer=e=>{let{src:t}=e;return(0,s.jsx)("audio",{controls:!0,src:t,className:"w-full mt-2",children:"お使いのブラウザはaudio要素に対応していません。"})}},4390:function(e,t,n){"use strict";n.d(t,{Z:function(){return LanguageSwitcher}});var s=n(5893),a=n(7294),r=n(3317);function LanguageSwitcher(e){let{onLanguageChange:t,className:n=""}=e,[l,c]=(0,a.useState)("ja"),[i,o]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=(0,r.UO)();c(e)},[]);let handleLanguageSelect=e=>{c(e),(0,r.bP)(e),o(!1),t&&t(e)};return(0,s.jsxs)("div",{className:"relative ".concat(n),children:[(0,s.jsxs)("button",{onClick:()=>o(!i),className:"flex items-center space-x-1 bg-gray-100 hover:bg-gray-200 rounded px-3 py-1 text-sm","aria-label":"言語選択",children:[(0,s.jsx)("span",{children:r.E7[l].flag}),(0,s.jsx)("span",{children:r.E7[l].nativeName}),(0,s.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(i?"rotate-180":""),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),i&&(0,s.jsx)("div",{className:"absolute right-0 mt-1 bg-white rounded shadow-lg z-10 py-1 min-w-32",children:Object.entries(r.E7).map(e=>{let[t,n]=e;return(0,s.jsxs)("button",{onClick:()=>handleLanguageSelect(t),className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-100 flex items-center space-x-2 \n                ".concat(l===t?"bg-gray-100":""),children:[(0,s.jsx)("span",{children:n.flag}),(0,s.jsx)("span",{children:n.nativeName})]},t)})})]})}},7353:function(e,t,n){"use strict";n.d(t,{V:function(){return Tag},Z:function(){return TagList}});var s=n(5893);n(7294);var a=n(1664),r=n.n(a);function Tag(e){let{tag:t,size:n="md",className:a="",asLink:l=!0}=e,c="inline-block rounded px-2 py-1 text-gray-700 bg-gray-200 hover:bg-gray-300 transition-colors",i={sm:"text-xs px-1.5 py-0.5",md:"text-sm px-2 py-1",lg:"text-base px-3 py-1.5"},o=(0,s.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,s.jsx)("span",{children:"#"}),(0,s.jsx)("span",{children:t})]});return l?(0,s.jsx)(r(),{href:"/tags/".concat(t),children:(0,s.jsx)("span",{className:"".concat(c," ").concat(i[n]," ").concat(a," cursor-pointer"),children:o})}):(0,s.jsx)("span",{className:"".concat(c," ").concat(i[n]," ").concat(a),children:o})}function TagList(e){let{tags:t,size:n="md",className:a="",asLinks:r=!0}=e;return t&&0!==t.length?(0,s.jsx)("div",{className:"flex flex-wrap gap-2 ".concat(a),children:t.map(e=>(0,s.jsx)(Tag,{tag:e,size:n,asLink:r},e))}):null}},3317:function(e,t,n){"use strict";n.d(t,{E7:function(){return s},UO:function(){return getLanguagePreference},bP:function(){return saveLanguagePreference},k$:function(){return a}});let s={ja:{name:"日本語",nativeName:"日本語",code:"ja",flag:"\uD83C\uDDEF\uD83C\uDDF5",dir:"ltr"},en:{name:"英語",nativeName:"English",code:"en",flag:"\uD83C\uDDFA\uD83C\uDDF8",dir:"ltr"},zh:{name:"中国語",nativeName:"中文",code:"zh",flag:"\uD83C\uDDE8\uD83C\uDDF3",dir:"ltr"},fr:{name:"フランス語",nativeName:"Fran\xe7ais",code:"fr",flag:"\uD83C\uDDEB\uD83C\uDDF7",dir:"ltr"},de:{name:"ドイツ語",nativeName:"Deutsch",code:"de",flag:"\uD83C\uDDE9\uD83C\uDDEA",dir:"ltr"}},a="ja";function saveLanguagePreference(e){localStorage.setItem("preferredLanguage",e)}function getLanguagePreference(){let e=localStorage.getItem("preferredLanguage");return e&&e in s?e:function(){let e=navigator.language.split("-")[0];return e in s?e:a}()}},1974:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSG:function(){return h},default:function(){return Home}});var s=n(5893),a=n(7294),r=n(7353),l=n(1664),c=n.n(l),i=n(4933),components_NovelCard=e=>{let{novel:t}=e;return(0,s.jsxs)("div",{className:"border-2 border-pink-200 rounded-lg p-4 mb-6 bg-white shadow-md hover:shadow-xl transition-shadow duration-300 hover:scale-105 transform hover:border-pink-400",children:[(0,s.jsx)(c(),{href:"/novels/".concat(t.slug),children:(0,s.jsx)("h2",{className:"text-xl font-bold mb-2 hover:text-pink-600 transition-colors",children:t.title})}),(0,s.jsx)("div",{className:"mb-2",children:(0,s.jsx)(r.Z,{tags:t.tags,size:"sm"})}),(0,s.jsx)("p",{className:"mb-3 text-gray-700 line-clamp-3",children:t.excerpt}),t.audioUrl&&(0,s.jsx)(i.z,{src:t.audioUrl}),(0,s.jsx)("div",{className:"mt-4 flex justify-end",children:(0,s.jsx)(c(),{href:"/novels/".concat(t.slug),className:"inline-block bg-pink-500 text-white px-4 py-1 rounded hover:bg-pink-600 transition-colors text-sm font-semibold shadow",children:"続きを読む"})})]})},components_NovelList=e=>{let{novels:t}=e;return(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(e=>(0,s.jsx)(components_NovelCard,{novel:e},e.slug))})},o=n(4390),u=n(3317),d=n(9008),x=n.n(d);let delay=e=>new Promise(t=>setTimeout(t,e));async function withRetry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;try{return await e()}catch(a){if(t<=0)throw a;return console.log("API呼び出しに失敗しました。".concat(n,"ms後にリトライします... (残り ").concat(t," 回)")),await delay(n),withRetry(e,t-1,n*s,s)}}let ApiError=class ApiError extends Error{static async fromResponse(e){let t={},n=e.statusText;try{n=(t=await e.json()).error||t.message||e.statusText}catch(t){try{n=await e.text()}catch(e){}}return new ApiError(e.status,e.statusText,n,t)}constructor(e,t,n,s){super(n),this.name="ApiError",this.status=e,this.statusText=t,this.data=s}};async function fetchWithErrorHandling(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;return withRetry(async()=>{let n=await fetch(e,t);if(429===n.status){let e=n.headers.get("Retry-After"),t=e?1e3*parseInt(e,10):6e4;throw console.log("レート制限に達しました。".concat(t,"ms後にリトライします...")),await delay(t),new ApiError(429,"Too Many Requests","レート制限に達しました")}if(!n.ok)throw await ApiError.fromResponse(n);return n},n)}var h=!0;function Home(e){let{novels:t,tags:n,tagCounts:l}=e,[c,i]=(0,a.useState)(t),[d,h]=(0,a.useState)(""),[g,m]=(0,a.useState)(u.k$),[f,p]=(0,a.useState)(null),[j,v]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=(0,u.UO)();m(e),e!==u.k$&&fetchNovelsForLanguage(e)},[]);let fetchNovelsForLanguage=async e=>{v(!0);try{let t=await fetchWithErrorHandling("/api/novels/list?lang=".concat(e)),n=await t.json();i(n)}catch(n){console.error("Failed to fetch novels for language:",e,n),i(t),alert(function(e){if(e instanceof ApiError)switch(e.status){case 401:return"認証に失敗しました。再ログインしてください。";case 403:return"この操作を行う権限がありません。";case 404:return"リクエストしたリソースが見つかりませんでした。";case 429:return"リクエストが集中しています。しばらく時間をおいて再試行してください。";case 500:case 502:case 503:return"サーバーエラーが発生しました。しばらく時間をおいて再試行してください。";default:return"エラーが発生しました: ".concat(e.message)}return"エラーが発生しました。時間をおいて再試行してください。"}(n))}finally{v(!1)}},w=c.filter(e=>(!f||!!e.tags.includes(f))&&(!d||e.title.toLowerCase().includes(d.toLowerCase())||e.excerpt.toLowerCase().includes(d.toLowerCase())||e.tags.some(e=>e.toLowerCase().includes(d.toLowerCase())))),handleLanguageChange=e=>{m(e),fetchNovelsForLanguage(e)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(x(),{children:[(0,s.jsx)("title",{children:"EroNews Generator - AIが生成する官能小説"}),(0,s.jsx)("meta",{name:"description",content:"AIが生成する官能小説をお楽しみください。"})]}),(0,s.jsxs)("main",{className:"max-w-4xl mx-auto py-8 px-4",children:[(0,s.jsxs)("header",{className:"flex flex-col md:flex-row justify-between items-center mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 mb-4 md:mb-0",children:[(0,s.jsx)("span",{className:"text-4xl",children:"\uD83C\uDF38"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-pink-600",children:"EroNews Generator"}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"AIが生成する官能小説をお楽しみください"})]})]}),(0,s.jsx)(o.Z,{onLanguageChange:handleLanguageChange})]}),j&&(0,s.jsx)("div",{className:"fixed inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50",children:(0,s.jsx)("div",{className:"text-lg",children:"読み込み中..."})}),(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold",children:[(0,s.jsx)("span",{className:"text-pink-600",children:"Ero"}),"News Generator"]}),(0,s.jsx)(o.Z,{onLanguageChange:handleLanguageChange})]}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("div",{className:"relative mb-4",children:[(0,s.jsx)("input",{type:"text",value:d,onChange:e=>h(e.target.value),placeholder:"キーワード・タグで検索",className:"border px-3 py-2 rounded-md w-full pr-10 focus:ring-2 focus:ring-pink-300 focus:border-pink-300 focus:outline-none"}),d&&(0,s.jsx)("button",{onClick:()=>h(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("h2",{className:"text-lg font-medium mb-2",children:"人気のタグ:"}),(0,s.jsx)(r.Z,{tags:n,className:f?"opacity-70":""})]}),f&&(0,s.jsxs)("div",{className:"flex items-center mt-3 bg-gray-100 rounded-md p-2",children:[(0,s.jsx)("span",{className:"mr-2",children:"フィルター:"}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)("button",{onClick:()=>p(null),className:"flex items-center bg-pink-100 text-pink-800 rounded px-2 py-1 text-sm",children:["#",f,(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})})]})]}),(0,s.jsxs)("div",{className:"mb-4 text-sm text-gray-600",children:[w.length," 件の結果"]}),w.length>0?(0,s.jsx)(components_NovelList,{novels:w}):(0,s.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[(0,s.jsx)("p",{className:"text-gray-500 mb-2",children:"検索結果がありません"}),(0,s.jsx)("button",{onClick:()=>{h(""),p(null)},className:"text-pink-600 hover:text-pink-800",children:"すべての作品を表示"})]})]})]})}},9008:function(e,t,n){e.exports=n(9201)}},function(e){e.O(0,[774,664,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);